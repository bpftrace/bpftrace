// Regression testing the map's thread safety.
// Bpftrace shouldn't crash during map's print/clear/zero operations
// while delete is called at the same time.
//
// For more information, please refer to:
// https://github.com/iovisor/bpftrace/pull/2623

i:us:1 {
    @data[rand % 10] = count();
    delete(@data[rand % 10]);
}

i:us:1 {
    print(@data);
    clear(@data);
    zero(@data);
}

i:s:1 {
    print("SUCCESS");
    exit();
}
